<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Found Reports - Bravehearts Lost & Found</title>
<link rel="stylesheet" href="lostreport.css">

<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; margin:0; padding:0; }
.video-background { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; overflow:hidden; }
.video-background video { width:100%; height:100%; object-fit:cover; }
.overlay { position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.3); z-index:-1; }

.card {
  background:rgba(255,255,255,0.9);
  max-width:800px;
  margin:50px auto;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
h2 { text-align:center; color:#13007d; }

.grid-container {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap:15px;
  margin-top:20px;
}

.report-card {
  background:#fff;
  padding:12px;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
  cursor:pointer;
  transition:0.2s;
}
.report-card:hover {
  transform: translateY(-3px);
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
}

.report-title { font-weight:bold; color:#13007d; }
.report-summary { font-size:14px; white-space: pre-wrap; }

.modal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.7);
  justify-content:center;
  align-items:center;
  z-index:1000;
}

.modal-content {
  background:#fff;
  padding:20px;
  border-radius:10px;
  max-width:600px;
  width:90%;
  max-height:90%;
  overflow-y:auto;
  position:relative;
}

.close-btn {
  position:absolute;
  top:10px; right:10px;
  background:#13007d;
  color:white;
  border:none;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
}

.photo-btn {
  margin-top:8px;
  padding:8px 12px;
  background:#13007d;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

button {
  margin-top:15px;
  padding:12px 20px;
  border:none;
  border-radius:8px;
  background:#13007d;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="video-background">
  <video autoplay muted loop playsinline>
    <source src="video/FAITH.mp4" type="video/mp4">
  </video>
</div>
<div class="overlay"></div>

<div class="card">
  <h2>All Submitted Found Reports</h2>
  <div id="summary" class="grid-container">Loading reports...</div>
  <button id="submitAnother">Submit Another Report</button>
</div>

<div id="reportModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" id="closeModal">Close</button>
    <div id="modalDetails"></div>
  </div>
</div>

<script>
const summaryDiv = document.getElementById('summary');
const modal = document.getElementById('reportModal');
const modalDetails = document.getElementById('modalDetails');
const closeModalBtn = document.getElementById('closeModal');
const submitAnother = document.getElementById('submitAnother');

const JSON_URL = "https://script.google.com/macros/s/AKfycbybspleJ7l0AYMP5u_SXzaGU7DDd_jlQQ_czXltrx_phOcYutFC9PEciGsj7eirrBkh/exec";

// show first 6 letters/numbers + rest masked
function formatEmail(email) {
  if (!email) return "N/A";
  const clean = email.replace(/[^a-zA-Z0-9]/g, '');
  const first6 = clean.slice(0, 6);
  const domainIndex = email.indexOf("@");
  const domain = domainIndex !== -1 ? email.slice(domainIndex) : "...";
  return first6 + domain;
}

async function loadReports() {
  try {
    const res = await fetch(JSON_URL);
    const reports = await res.json();

    if (!reports.length) {
      summaryDiv.innerHTML = "<p>No reports submitted yet.</p>";
      return;
    }

    summaryDiv.innerHTML = "";

    reports.forEach((data, idx) => {
      const card = document.createElement('div');
      card.className = 'report-card';

      const normalizedData = {};
      for (const key in data) normalizedData[key.trim()] = data[key];

      const whatVal   = normalizedData.What   || "-";
      const lockerVal = normalizedData.Locker || "Not Claimed";
      const statusVal = normalizedData.Status || "";

      const isClaimed = statusVal.toString().trim().toUpperCase() === "CLAIM";

      // ONLY What and Status on summary
      let summaryHTML = `<div class="report-title">Report #${idx + 1}</div>`;
      summaryHTML += `<div class="report-summary"><strong>What:</strong> ${whatVal}</div>`;
      summaryHTML += `<div class="report-summary"><strong>Status:</strong> ${lockerVal}</div>`;

      card.innerHTML = summaryHTML;

      // MODAL DETAILS
      card.onclick = () => {
        let html = `<h3>Report #${idx + 1}</h3>`;

        const fields = [
          "Timestamp","Email","What",
          "When","Where","Who","More info",
          "Description","Locker","Photo"
        ];

        fields.forEach(field => {
          let value = normalizedData[field] || "N/A";

          if (field === "Email") {
            value = formatEmail(value);
          }

          // hide photo if claimed
          if (field === "Photo" && isClaimed) return;

          if (field === "Photo") {
            if (value && value !== "N/A" && value.trim() !== "") {
              html += `
                <div>
                  <strong>${field}:</strong><br>
                  <button class="photo-btn"
                    onclick="window.open('${value}', '_blank')">
                    View Photo
                  </button>
                </div>`;
            } else {
              html += `<div><strong>${field}:</strong> N/A</div>`;
            }
            return;
          }

          html += `
            <div>
              <strong>${field}:</strong>
              <span style="white-space: pre-wrap;">${value}</span>
            </div>`;
        });

        modalDetails.innerHTML = html;
        modal.style.display = 'flex';
      };

      summaryDiv.appendChild(card);
    });

  } catch (err) {
    console.error(err);
    summaryDiv.innerHTML = "<p>Error loading reports.</p>";
  }
}

closeModalBtn.onclick = () => modal.style.display = 'none';
window.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };
submitAnother.onclick = () => window.location.href = 'index.html';

loadReports();
</script>

</body>
</html>

